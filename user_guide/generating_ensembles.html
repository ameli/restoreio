


<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<meta property="og:title" content="Generating Ensembles" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://ameli.github.io/user_guide/generating_ensembles.html" />
<meta property="og:site_name" content="RestoreIO" />
<meta property="og:description" content="Beyond its data reconstruction capabilities, restoreio also provides the feature to create ensembles of the velocity vector field. These ensembles are crucial for quantifying uncertainties, which holds significance for various applications. For a more in-depth understanding of the ensemble genera..." />
<meta property="og:image" content="https://restoreio.org/public/images/card.png" />
<meta property="og:image:alt" content="RestoreIO" />
<meta name="description" content="Beyond its data reconstruction capabilities, restoreio also provides the feature to create ensembles of the velocity vector field. These ensembles are crucial for quantifying uncertainties, which holds significance for various applications. For a more in-depth understanding of the ensemble genera..." />

    <title>Generating Ensembles &#8212; restoreio Manual</title>
<script>
  document.documentElement.dataset.mode = localStorage.getItem("mode") || "auto";
  document.documentElement.dataset.theme = localStorage.getItem("theme") || "light"
</script>

  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=92025949c220c2e29695" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=92025949c220c2e29695" rel="stylesheet">


  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom-pydata.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />

  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/toggleprompt.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/js/custom-pydata.js"></script>
    <script src="../_static/design-tabs.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]]}, "tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/custom-pydata.css"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Output Variables" href="output_var.html" />
    <link rel="prev" title="Data Restoration Settings" href="restore_setting.html" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-RCTBMM27GH"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-RCTBMM27GH');
    </script>

    <script defer data-domain="docs.scipy.org" src="https://views.scientific-python.org/js/script.js"></script>

    <!-- My custom JS -->
    <script type="text/javascript" src="../_static/js/custom-pydata.js"></script>

    <!-- Syntax highlighting for BibTex code blocks -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism-solarizedlight.min.css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/prism.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs-bibtex@2.0.1/prism-bibtex.min.js"></script>

    
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="docsearch:language" content="en">

  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="auto">
    <div class="bd-header-announcement container-fluid" id="banner">
      

    </div>

    
    <nav class="bd-header navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="bd-header__inner container-xl">

  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../contents.html">
  
  
  
  
    <img src="../_static/images/icons/logo-restoreio-light.png" class="logo__image only-light" alt="Logo image">
    <img src="../_static/images/icons/logo-restoreio-dark.png" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="fas fa-bars"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="user_guide.html">
  User Guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../api/api.html">
  API Reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../examples.html">
  Examples
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <span id="theme-switch" class="btn btn-sm btn-outline-primary navbar-btn rounded-circle">
    <a class="theme-switch" data-mode="light"><i class="fas fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="far fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fas fa-adjust"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/ameli/restoreio" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://pypi.org/project/restoreio/" rel="noopener" target="_blank" title="PyPI"><span><i class="fab fa-python"></i></span>
            <label class="sr-only">PyPI</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://anaconda.org/s-ameli/restoreio" rel="noopener" target="_blank" title="Anaconda Cloud"><span><i class="fa fa-circle-notch"></i></span>
            <label class="sr-only">Anaconda Cloud</label></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://restoreio.org" rel="noopener" target="_blank" title="Online RestoreIO Platform"><span><i class="fas fa-globe-americas"></i></span>
            <label class="sr-only">Online RestoreIO Platform</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="bd-container container-xl">
      <div class="bd-container__inner row">
          

<!-- Only show if we have sidebars configured, else just a small margin  -->
<div class="bd-sidebar-primary col-12 col-md-3 bd-sidebar">
  <div class="sidebar-start-items"><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
    <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="user_guide.html">
   User Guide
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="getting_started.html">
   Getting Started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="input_data.html">
   Input Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="restore_setting.html">
   Data Restoration Settings
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Generating Ensembles
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="output_var.html">
   Output Variables
  </a>
 </li>
</ul>

    
  </div>
</nav>
  </div>
  <div class="sidebar-end-items">
  </div>
</div>


          


<div class="bd-sidebar-secondary d-none d-xl-block col-xl-2 bd-toc">
  
    
    <div class="toc-item">
      
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#required-variables">
   Required Variables
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ensemble-generation-settings">
   Ensemble Generation Settings
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#write-ensembles-to-output">
     Write Ensembles to Output
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#number-of-monte-carlo-samples">
     Number of (Monte-Carlo) Samples
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#number-of-eigen-modes">
     Number of Eigen-Modes
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#kernel-width">
     Kernel Width
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#scale-velocity-errors">
     Scale Velocity Errors
    </a>
   </li>
  </ul>
 </li>
</ul>

</nav>
    </div>
    
    <div class="toc-item">
      

<div class="tocsection editthispage">
    <a href="https://github.com/ameli/restoreio/edit/main/docs/source/user_guide/generating_ensembles.rst">
        <i class="fas fa-pencil-alt"></i> Edit this page
    </a>
</div>

    </div>
    
  
</div>


          
          
          <div class="bd-content col-12 col-md-9 col-xl-7">
              
              <article class="bd-article" role="main">
                
  <section id="generating-ensembles">
<span id="id1"></span><h1><a class="toc-backref" href="#id2" role="doc-backlink">Generating Ensembles</a><a class="headerlink" href="#generating-ensembles" title="Permalink to this heading">#</a></h1>
<p>Beyond its data reconstruction capabilities, <span class="synco">restoreio</span> also provides the feature to create ensembles of the velocity vector field. These ensembles are crucial for quantifying uncertainties, which holds significance for various applications. For a more in-depth understanding of the ensemble generation algorithm, we direct interested readers to <a class="reference internal" href="../cite.html#ref2"><span class="std std-ref">[2]</span></a>.</p>
<p>To create velocity ensembles, simply activate the <code class="docutils literal notranslate"><span class="pre">uncertainty_quant</span></code> option within <a class="reference internal" href="../api/generated/restoreio.restore.html#restoreio.restore" title="restoreio.restore"><code class="xref py py-func docutils literal notranslate"><span class="pre">restoreio.restore()</span></code></a>. Do note that ensembles can be generated for <strong>a single time point</strong> only. This section elaborates on the utilization of <a class="reference internal" href="../api/generated/restoreio.restore.html#restoreio.restore" title="restoreio.restore"><code class="xref py py-func docutils literal notranslate"><span class="pre">restoreio.restore()</span></code></a> specifically for ensemble generation purposes.</p>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#generating-ensembles" id="id2">Generating Ensembles</a></p>
<ul>
<li><p><a class="reference internal" href="#required-variables" id="id3">Required Variables</a></p></li>
<li><p><a class="reference internal" href="#ensemble-generation-settings" id="id4">Ensemble Generation Settings</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="required-variables">
<span id="ensemble-var-sec"></span><h2><a class="toc-backref" href="#id3" role="doc-backlink">Required Variables</a><a class="headerlink" href="#required-variables" title="Permalink to this heading">#</a></h2>
<p>To generate ensembles, you should provide one of the following additional variables in your input file:</p>
<ul class="simple">
<li><p><a class="reference internal" href="input_data.html#ocean-vel-err-var-sec"><span class="std std-ref">Ocean’s Surface East and North Velocity Error Variables</span></a></p></li>
<li><p><a class="reference internal" href="input_data.html#ocean-gdop-var-sec"><span class="std std-ref">Geometric Dilution of Precision Variables</span></a></p></li>
</ul>
<p>If you choose to provide GDOP variables instead of the velocity error variables, the velocity errors are calculated from GDOP as follows:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align}
\sigma_e &amp;= \sigma_r \mathrm{GDOP}_e, \\
\sigma_n &amp;= \sigma_r \mathrm{GDOP}_n,
\end{align}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\sigma_e\)</span> and <span class="math notranslate nohighlight">\(\sigma_n\)</span> are the east and north components of the velocity error, <span class="math notranslate nohighlight">\(\mathrm{GDOP_e}\)</span> and <span class="math notranslate nohighlight">\(\mathrm{GDOP}_n\)</span> are the east and north components of the GDOP, respectively, and <span class="math notranslate nohighlight">\(\sigma_r\)</span> is the radar’s radial error. You can specify <span class="math notranslate nohighlight">\(\sigma_r\)</span> using the <code class="docutils literal notranslate"><span class="pre">scale_error</span></code> argument within the function (also refer to <a class="reference internal" href="#scale-vel-error-sec"><span class="std std-ref">Scale Velocity Errors</span></a> section below).</p>
</section>
<section id="ensemble-generation-settings">
<span id="ensemble-settings-sec"></span><h2><a class="toc-backref" href="#id4" role="doc-backlink">Ensemble Generation Settings</a><a class="headerlink" href="#ensemble-generation-settings" title="Permalink to this heading">#</a></h2>
<p>The following settings for ensemble generation can be set within the <a class="reference internal" href="../api/generated/restoreio.restore.html#restoreio.restore" title="restoreio.restore"><code class="xref py py-func docutils literal notranslate"><span class="pre">restoreio.restore()</span></code></a> function:</p>
<section id="write-ensembles-to-output">
<span id="write-ensembles"></span><h3>Write Ensembles to Output<a class="headerlink" href="#write-ensembles-to-output" title="Permalink to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">write_ensembles</span></code> option allows you to save the entire population of ensemble vector fields to the output file. If this option is not enabled, only the <em>mean</em> and <em>standard deviation</em> of the ensembles will be stored. For more details, please refer to the <a class="reference internal" href="output_var.html#output-var-sec"><span class="std std-ref">Output Variables</span></a> section.</p>
</section>
<section id="number-of-monte-carlo-samples">
<span id="num-samples-sec"></span><h3>Number of (Monte-Carlo) Samples<a class="headerlink" href="#number-of-monte-carlo-samples" title="Permalink to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">num_ensembles</span></code> argument of the function enables you to specify the number of ensembles to be generated. This value should be greater than the number of velocity data points. Keep in mind that the processing time increases <strong>linearly</strong> with larger sample sizes.</p>
</section>
<section id="number-of-eigen-modes">
<span id="num-eigenmodes-sec"></span><h3>Number of Eigen-Modes<a class="headerlink" href="#number-of-eigen-modes" title="Permalink to this heading">#</a></h3>
<p>To generate ensembles, the eigenvalues and eigenvectors of the covariance matrix of the velocity data need to be computed. For a velocity data with <span class="math notranslate nohighlight">\(n\)</span> data points, this means the eigenvalues and eigenvectors of an <span class="math notranslate nohighlight">\(n \times n\)</span> matrix have to be calculated. However, such a computation has a complexity of <span class="math notranslate nohighlight">\(\mathcal{O}(n^3)\)</span>, which can be infeasible for large datasets.</p>
<p>To handle this, we employ a practical approach where we only compute a reduced number of <span class="math notranslate nohighlight">\(m\)</span> eigenvalues and eigenvectors of the covariance matrix, where <span class="math notranslate nohighlight">\(m\)</span> can be much smaller than <span class="math notranslate nohighlight">\(n\)</span>. This simplification reduces the complexity to <span class="math notranslate nohighlight">\(\mathcal{O}(n m^2)\)</span>, which enables us to process larger datasets while maintaining a reasonable level of accuracy. For a better understanding of this concept, we refer the interested reader to Section 4 of <a class="reference internal" href="../cite.html#ref2"><span class="std std-ref">[2]</span></a>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">ratio_num_modes</span></code> argument of the function allows you to specify the number of eigenvectors of the data covariance to be utilized in the computations. The number of modes should be given as a percentage of the ratio <span class="math notranslate nohighlight">\(m/n\)</span>.</p>
<p>Keep in mind that the processing time <strong>quadratically</strong> increases with the number of eigenmodes. We recommend setting this value to around 5% to 10% for most datasets.</p>
</section>
<section id="kernel-width">
<span id="kernel-width-sec"></span><h3>Kernel Width<a class="headerlink" href="#kernel-width" title="Permalink to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">kernel_width</span></code> argument of the function represents the width of a spatial kernel used to construct the covariance matrix of the velocity data. The kernel width is measured in the unit of the velocity data points. For example, a kernel width of 5 on an HF radar dataset with a 2 km spatial resolution implies a kernel width of 10 km.</p>
<p>It is assumed that spatial distances larger than the kernel width are uncorrelated. Therefore, reducing the kernel width makes the covariance matrix of the data more sparse, resulting in more efficient processing. However, a smaller kernel width may lead to information loss within the dataset. As a general recommendation, we suggest setting this value to 5 to 20 data points.</p>
</section>
<section id="scale-velocity-errors">
<span id="scale-vel-error-sec"></span><h3>Scale Velocity Errors<a class="headerlink" href="#scale-velocity-errors" title="Permalink to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">scale_error</span></code> argument serves two purposes:</p>
<ul class="simple">
<li><p>If the <a class="reference internal" href="input_data.html#ocean-vel-err-var-sec"><span class="std std-ref">Ocean’s Surface East and North Velocity Error Variables</span></a> are included in the input dataset, the provided scale value is multiplied by the velocity error. This is useful to match the unit of the velocity error to the unit of the velocity data if they are not in the same unit. If you have velocity errors in the same unit as the velocity data, it is recommended to set this quantity to 1.</p></li>
<li><p>If the <a class="reference internal" href="input_data.html#ocean-gdop-var-sec"><span class="std std-ref">Geometric Dilution of Precision (GDOP) Variables</span></a> are included in the input dataset, the given scale value is interpreted as the HF radar’s radial error, <span class="math notranslate nohighlight">\(\sigma_r\)</span>. In this case, the velocity error is calculated by multiplying the radar’s radial error by the GDOP variables. The typical range for the radial errors of HF radars is between 0.05 to 0.20 meters per second.</p></li>
</ul>
</section>
</section>
</section>


              </article>
              

              
              <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="restore_setting.html" title="previous page">
      <i class="fas fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">Data Restoration Settings</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="output_var.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">Output Variables</p>
  </div>
  <i class="fas fa-angle-right"></i>
  </a>
</div>
              </footer>
              
          </div>
          
      </div>
    </div>

  
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=92025949c220c2e29695"></script>


    <!-- Adobe Embed API -->
    
    <script src="https://documentcloud.adobe.com/view-sdk/main.js"></script>


  </body>
</html>